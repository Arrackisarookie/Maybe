### 2019.9.24

##### 更正
我发现下面的报错不是因为 flask 多线程导致读写冲突，而是 shelve 打开文件时默认不支持更改数据
```Python
    shelve.open(filename, flag='c', protocol=None, writeback=False)
```

writeback 默认为 False，即不能动态写回数据，更改为 True 上面的 error 就没了。

---

再一次的想砸电脑。。
突然怀念起数据库的好。。
由于是静态博客，所以数据是用 shelve 存储的。我刚意识到这样的数据存储和更新是有多愚蠢。。 

##### 目前遇到的问题是: 
原本 yukun 大佬的设计是，每次运行 Generate 就会把资源目录里的 .md 全部重新生成一遍，我认为很浪费资源，就改了一下实现。  
  
由于 generate_article 函数会将 _article 中所有 md 全部生成 html  
  
我就在每个 md 文件生成 html 之后，将该 md 文件移动至 source 目录下的 _finished 目录中。  
  
然后，上传文件之后调用 gen() 就不会对原有 md 二次操作了。  
  
但是！  

这样做必须将内存中的标签，分类，文章信息全部保存在硬盘。每次上传文件就会读取这些数据，并更新他们，再根据新的数据，生成新的标签，分类，文章索引页面。  

按理说，用数据库的话，就是个 update 再 select 的事情，用 flask-sqlalchemy 还能保证没冲突。  
可是 shelve 太简单了。。他同时读写时不是线程安全的。。但 flask 多线程啊。。  
有读有写。。这不就崩了。。 

```
    _gdbm.error: [Errno 11] Resource temporarily unavailable  
```

这就很难受了。。我在研究一下怎么控制读写保护。。  
实在不行，就还是每回都重新生成吧。。  

---
2019.9.22
重构了一下 yukun 大佬的 [quiet](https://github.com/blackyukun/quiet)，主要是改了 generate.py 这个文件。  

搞模板搞得要吐了，我缓缓。。明天见。。
  
---
2019.9.21  
两天时间，查了很多资料，看了很多别人家的代码，也尝试了很多，最后决定为本博客定义以下标签:  
个人，静态，markdown，Flask  
启发于[Blackyukun](https://github.com/blackyukun)
yukun 大佬你的博客以后就是我的目标了 hhhh ~

---
2019.9.19  
按照原本的构思，version 0.0.3 应该上线支持 markdown ，但在翻了一整天的别人的代码之后，发现自己对于整体框架把握一直不太清晰，对具体功能的实现也并不确定。  
所以我决定，仔细想一下到底要做什么，实现什么功能，需要怎样的结构，以怎样的方式来实现它们。  
  
等我归来。  

---
2019.9.19 之前  
当时的想法是跟着 greyli 老师的 hello Flask 将博客搭起来，基本没有自己的想法，主要也是当时什么也不太懂，不知道博客该有些什么，结构功能就很随便，人家有啥我就抄啥，也不知道抄的是啥hhhhh。  
后来慢慢了解到有很多种形式，比如前后端分离的，纯静态页面的，连数据库的等等。当见识的稍微多一些了，就会发现能走的路有很多条，于是就有了 9.19 的那些话。

