### 2019.9.30
一切的拓展都是扯淡，还是要先把基本功能给完成了。  

**主页，分类，标签，文章**  

其他的都是扯淡空想。  


---

**2019.9.28**

曾几何时，观文至感同身受，顿足捶胸，只想对文字作者说一句 **你不是一个人hhh**，   
曾何几时，寻寻觅觅，苦苦探索 N 久，终于得偿所愿找到解答，只想对大佬说句 **dlnb**，
曾时几何，见到傻批在装批吹牛批还喊着 mmp，只想怼他到昏天黑地日月无光，

可正当一腔狗血涌上心头，马上就要喷薄而出之时，

却怎奈！

要想发言，

得登录！要注册！

于是，心里只剩俩字，

**算了**

逗逼，给劳资爬开。。

咳咳，总之，为了在我的博客中避免这种尴尬，我决定重新构思用户分类。

正片

用户分为
掌门，长老，道友，潜在道友，芸芸众生

- 芸芸众生
    + 所有未登记的 visitor 都是芸芸众生
    + 只能浏览
- 潜在道友
    + 只需输个名字就是潜在道友啦
    + 可以点赞，留言，评论
    + 想的是用 Cookie 识别身份
    + 名字唯一，不可重复
    + 默认 15 天不刷新 Cookie 就被标记为飞升
    + 飞升不删除评论点赞留言
    + 再次登记飞升道友的名字，会以 `名字丶第n世` 格式命名
- 道友
    + 潜在道友加密码
    + 身份永久
- 长老
    + 道友的进阶版
    + 管理评论留言
    + 可发说说，评论说说
- 掌门
    + 可任命道友为长老
    + 最高权限
    + 想干啥干啥

---

**2019.9.26**
数据库决定依旧使用 MySQL 老大哥。  
既然已经开始使用数据库，那么网站的整体实现就需要重新布置。  

网站主体中的实体主要的就这么两个:   **用户, 文章**

分开细说，

##### 用户


_未注册，普通用户，管理者，管理员_  (**权限向左兼容**)  
  
- 未注册可浏览文章，点赞文章
- 注册后默认为普通用户，可以留言，评论，并有权删除个人言论
- 管理者可以发布文章，操作留言，评论，操作后对相应用户进行告知
- 管理员可任命高级用户，操作用户，审核文章

##### 文章
_以 markdown 格式存储，可在线编辑，也可上传。_  

在线编辑先不谈，大概率引其他开源项目。  

上传的文章
- 需要进行 meta 的设置，诸如 title，tag，category
- 可在线预览
- 需要管理员审核

说下 md -> html  

文章审核通过后，会通过程序生成如下的 html
```html
    {% block content %}
    ...
    <p>文章内容</p>
    ...
    {% endblock %}
```
保存在如下路径中
```
    templates/generated/year/month/article_name
```
然后将文件路径保存数据库中。

**附加**  

说说和留言版  
这个其实也是我的执念，  
扣扣空间的说说和留言板确实承载了我太多的回忆，  
可惜时间久远物是人非了，  
所以就想着来个 one more time  
  
就酱~ヽ(●´∀`●)ﾉ

---

**2019.9.25**  
思来想去，引入数据库做数据管理还是康庄大道，无论是 SQL 还是 NoSQL。  

看到用户登录的设计不是很爽，决定改之，但还是会先将文件上传搞定。  
在考虑是不是改回有数据库的模式，我需要读读书了。  

---

**2019.9.24**

##### 更正
我发现下面的报错不是因为 flask 多线程导致读写冲突，而是 shelve 打开文件时默认不支持更改数据
```Python
    shelve.open(filename, flag='c', protocol=None, writeback=False)
```

writeback 默认为 False，即不能动态写回数据，更改为 True 上面的 error 就没了。  

---------------------华丽的分隔符----------------------  

再一次的想砸电脑。。
突然怀念起数据库的好。。
由于是静态博客，所以数据是用 shelve 存储的。我刚意识到这样的数据存储和更新是有多愚蠢。。 

##### 目前遇到的问题是: 
原本 yukun 大佬的设计是，每次运行 Generate 就会把资源目录里的 .md 全部重新生成一遍，我认为很浪费资源，就改了一下实现。  
  
由于 generate_article 函数会将 _article 中所有 md 全部生成 html  
  
我就在每个 md 文件生成 html 之后，将该 md 文件移动至 source 目录下的 _finished 目录中。  
  
然后，上传文件之后调用 gen() 就不会对原有 md 二次操作了。  
  
但是！  

这样做必须将内存中的标签，分类，文章信息全部保存在硬盘。每次上传文件就会读取这些数据，并更新他们，再根据新的数据，生成新的标签，分类，文章索引页面。  

按理说，用数据库的话，就是个 update 再 select 的事情，用 flask-sqlalchemy 还能保证没冲突。  
可是 shelve 太简单了。。他同时读写时不是线程安全的。。但 flask 多线程啊。。  
有读有写。。这不就崩了。。 

```
    _gdbm.error: [Errno 11] Resource temporarily unavailable  
```

这就很难受了。。我在研究一下怎么控制读写保护。。  
实在不行，就还是每回都重新生成吧。。  

---
**2019.9.22**
重构了一下 yukun 大佬的 [quiet](https://github.com/blackyukun/quiet)，主要是改了 generate.py 这个文件。  

搞模板搞得要吐了，我缓缓。。明天见。。
  
---
**2019.9.21** 
两天时间，查了很多资料，看了很多别人家的代码，也尝试了很多，最后决定为本博客定义以下标签:  
个人，静态，markdown，Flask  
启发于[Blackyukun](https://github.com/blackyukun)
yukun 大佬你的博客以后就是我的目标了 hhhh ~

---
**2019.9.19**  
按照原本的构思，version 0.0.3 应该上线支持 markdown ，但在翻了一整天的别人的代码之后，发现自己对于整体框架把握一直不太清晰，对具体功能的实现也并不确定。  
所以我决定，仔细想一下到底要做什么，实现什么功能，需要怎样的结构，以怎样的方式来实现它们。  
  
等我归来。  

---
**之前**  
当时的想法是跟着 greyli 老师的 hello Flask 将博客搭起来，基本没有自己的想法，主要也是当时什么也不太懂，不知道博客该有些什么，结构功能就很随便，人家有啥我就抄啥，也不知道抄的是啥hhhhh。  
后来慢慢了解到有很多种形式，比如前后端分离的，纯静态页面的，连数据库的等等。当见识的稍微多一些了，就会发现能走的路有很多条，于是就有了 9.19 的那些话。

